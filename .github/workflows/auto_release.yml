name: Auto Release

on:
  workflow_call:
    
jobs:
  auto_release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: fabasoad/data-format-converter-action@main
        id: xml2json
        with:
          input: 'Config/module.xml'
          from: 'xml'
          to: 'json'
      - name: Get commit sha
        shell: bash
        run: echo "COMMIT_SHA=$(echo ${GITHUB_SHA})" >> $GITHUB_ENV
      - uses: rickstaa/action-create-tag@v1
        id: "tag_create"
        with:
          tag: ${{ fromJSON(steps.xml2json.outputs.output).module.version }}
          tag_exists_error: false
          commit_sha: ${ env.COMMIT_SHA }
      - name: Create Release
        uses: ncipollo/release-action@v1.12.0
        with:
          tag: ${{ fromJSON(steps.xml2json.outputs.output).module.version }}
          skipIfReleaseExists: true
